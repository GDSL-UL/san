<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Spatial Econometrics | Spatial Analysis Notes</title>
  <meta name="description" content="Materials for a Spatial Analysis course in R." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Spatial Econometrics | Spatial Analysis Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Materials for a Spatial Analysis course in R." />
  <meta name="github-repo" content="gdsl-ul/san" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Spatial Econometrics | Spatial Analysis Notes" />
  
  <meta name="twitter:description" content="Materials for a Spatial Analysis course in R." />
  

<meta name="author" content="Francisco Rowe &amp; Dani Arribas-Bel" />


<meta name="date" content="2020-04-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="flows.html"/>
<link rel="next" href="multilevel-modelling-part-1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Analysis Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Spatial Analysis Notes</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#dependencies"><i class="fa fa-check"></i><b>2.1</b> Dependencies</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#introducing-r"><i class="fa fa-check"></i><b>2.2</b> Introducing R</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#setting-the-working-directory"><i class="fa fa-check"></i><b>2.3</b> Setting the working directory</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#r-scripts-and-notebooks"><i class="fa fa-check"></i><b>2.4</b> R Scripts and Notebooks</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#getting-help"><i class="fa fa-check"></i><b>2.5</b> Getting Help</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#variables-and-objects"><i class="fa fa-check"></i><b>2.6</b> Variables and objects</a><ul>
<li class="chapter" data-level="2.6.1" data-path="intro.html"><a href="intro.html#basic-data-types"><i class="fa fa-check"></i><b>2.6.1</b> Basic Data Types</a></li>
<li class="chapter" data-level="2.6.2" data-path="intro.html"><a href="intro.html#random-variables"><i class="fa fa-check"></i><b>2.6.2</b> Random Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="intro.html"><a href="intro.html#data-frames"><i class="fa fa-check"></i><b>2.7</b> Data Frames</a><ul>
<li class="chapter" data-level="2.7.1" data-path="intro.html"><a href="intro.html#creating-a-data-frame"><i class="fa fa-check"></i><b>2.7.1</b> Creating A Data Frame</a></li>
<li class="chapter" data-level="2.7.2" data-path="intro.html"><a href="intro.html#referencing-data-frames"><i class="fa fa-check"></i><b>2.7.2</b> Referencing Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="intro.html"><a href="intro.html#sec_readdata"><i class="fa fa-check"></i><b>2.8</b> Read Data</a><ul>
<li class="chapter" data-level="2.8.1" data-path="intro.html"><a href="intro.html#quickly-inspect-the-data"><i class="fa fa-check"></i><b>2.8.1</b> Quickly inspect the data</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="intro.html"><a href="intro.html#manipulation-data"><i class="fa fa-check"></i><b>2.9</b> Manipulation Data</a><ul>
<li class="chapter" data-level="2.9.1" data-path="intro.html"><a href="intro.html#adding-new-variables"><i class="fa fa-check"></i><b>2.9.1</b> Adding New Variables</a></li>
<li class="chapter" data-level="2.9.2" data-path="intro.html"><a href="intro.html#selecting-variables"><i class="fa fa-check"></i><b>2.9.2</b> Selecting Variables</a></li>
<li class="chapter" data-level="2.9.3" data-path="intro.html"><a href="intro.html#filtering-data"><i class="fa fa-check"></i><b>2.9.3</b> Filtering Data</a></li>
<li class="chapter" data-level="2.9.4" data-path="intro.html"><a href="intro.html#joining-data-drames"><i class="fa fa-check"></i><b>2.9.4</b> Joining Data Drames</a></li>
<li class="chapter" data-level="2.9.5" data-path="intro.html"><a href="intro.html#saving-data"><i class="fa fa-check"></i><b>2.9.5</b> Saving Data</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="intro.html"><a href="intro.html#using-spatial-data-frames"><i class="fa fa-check"></i><b>2.10</b> Using Spatial Data Frames</a><ul>
<li class="chapter" data-level="2.10.1" data-path="intro.html"><a href="intro.html#read-spatial-data"><i class="fa fa-check"></i><b>2.10.1</b> Read Spatial Data</a></li>
<li class="chapter" data-level="2.10.2" data-path="intro.html"><a href="intro.html#basic-mapping"><i class="fa fa-check"></i><b>2.10.2</b> Basic Mapping</a></li>
<li class="chapter" data-level="2.10.3" data-path="intro.html"><a href="intro.html#comparing-geographies"><i class="fa fa-check"></i><b>2.10.3</b> Comparing geographies</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="intro.html"><a href="intro.html#useful-functions"><i class="fa fa-check"></i><b>2.11</b> Useful Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="points.html"><a href="points.html"><i class="fa fa-check"></i><b>3</b> Points</a><ul>
<li class="chapter" data-level="3.1" data-path="points.html"><a href="points.html#dependencies-1"><i class="fa fa-check"></i><b>3.1</b> Dependencies</a></li>
<li class="chapter" data-level="3.2" data-path="points.html"><a href="points.html#data"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="points.html"><a href="points.html#kde"><i class="fa fa-check"></i><b>3.3</b> KDE</a><ul>
<li class="chapter" data-level="3.3.1" data-path="points.html"><a href="points.html#one-dimensional-kde"><i class="fa fa-check"></i><b>3.3.1</b> One-dimensional KDE</a></li>
<li class="chapter" data-level="3.3.2" data-path="points.html"><a href="points.html#two-dimensional-spatial-kde"><i class="fa fa-check"></i><b>3.3.2</b> Two-dimensional (spatial) KDE</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="points.html"><a href="points.html#spatial-interpolation"><i class="fa fa-check"></i><b>3.4</b> Spatial Interpolation</a><ul>
<li class="chapter" data-level="3.4.1" data-path="points.html"><a href="points.html#inverse-distance-weight-idw-interpolation"><i class="fa fa-check"></i><b>3.4.1</b> Inverse Distance Weight (IDW) interpolation</a></li>
<li class="chapter" data-level="3.4.2" data-path="points.html"><a href="points.html#a-surface-of-housing-prices"><i class="fa fa-check"></i><b>3.4.2</b> A surface of housing prices</a></li>
<li class="chapter" data-level="3.4.3" data-path="points.html"><a href="points.html#what-should-the-next-houses-price-be"><i class="fa fa-check"></i><b>3.4.3</b> <em>“What should the next house’s price be?”</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="flows.html"><a href="flows.html"><i class="fa fa-check"></i><b>4</b> Flows</a><ul>
<li class="chapter" data-level="4.1" data-path="flows.html"><a href="flows.html#dependencies-2"><i class="fa fa-check"></i><b>4.1</b> Dependencies</a></li>
<li class="chapter" data-level="4.2" data-path="flows.html"><a href="flows.html#data-1"><i class="fa fa-check"></i><b>4.2</b> Data</a></li>
<li class="chapter" data-level="4.3" data-path="flows.html"><a href="flows.html#seeing-flows"><i class="fa fa-check"></i><b>4.3</b> “<em>Seeing</em>” flows</a></li>
<li class="chapter" data-level="4.4" data-path="flows.html"><a href="flows.html#modelling-flows"><i class="fa fa-check"></i><b>4.4</b> Modelling flows</a></li>
<li class="chapter" data-level="4.5" data-path="flows.html"><a href="flows.html#predicting-flows"><i class="fa fa-check"></i><b>4.5</b> Predicting flows</a></li>
<li class="chapter" data-level="4.6" data-path="flows.html"><a href="flows.html#references"><i class="fa fa-check"></i><b>4.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html"><i class="fa fa-check"></i><b>5</b> Spatial Econometrics</a><ul>
<li class="chapter" data-level="5.1" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#dependencies-3"><i class="fa fa-check"></i><b>5.1</b> Dependencies</a></li>
<li class="chapter" data-level="5.2" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#data-2"><i class="fa fa-check"></i><b>5.2</b> Data</a></li>
<li class="chapter" data-level="5.3" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#non-spatial-regression-a-refresh"><i class="fa fa-check"></i><b>5.3</b> Non-spatial regression, a refresh</a></li>
<li class="chapter" data-level="5.4" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#spatial-regression-a-very-first-dip"><i class="fa fa-check"></i><b>5.4</b> Spatial regression: a (very) first dip</a></li>
<li class="chapter" data-level="5.5" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#spatial-heterogeneity"><i class="fa fa-check"></i><b>5.5</b> Spatial heterogeneity</a></li>
<li class="chapter" data-level="5.6" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#spatial-dependence"><i class="fa fa-check"></i><b>5.6</b> Spatial dependence</a></li>
<li class="chapter" data-level="5.7" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#predicting-house-prices"><i class="fa fa-check"></i><b>5.7</b> Predicting house prices</a></li>
<li class="chapter" data-level="5.8" data-path="spatial-econometrics.html"><a href="spatial-econometrics.html#references-1"><i class="fa fa-check"></i><b>5.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html"><i class="fa fa-check"></i><b>6</b> Multilevel Modelling - Part 1</a><ul>
<li class="chapter" data-level="6.1" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#dependencies-4"><i class="fa fa-check"></i><b>6.1</b> Dependencies</a></li>
<li class="chapter" data-level="6.2" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#data-3"><i class="fa fa-check"></i><b>6.2</b> Data</a></li>
<li class="chapter" data-level="6.3" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#modelling"><i class="fa fa-check"></i><b>6.3</b> Modelling</a><ul>
<li class="chapter" data-level="6.3.1" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#baseline-linear-regression-model"><i class="fa fa-check"></i><b>6.3.1</b> Baseline Linear Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#multilevel-modelling-random-intercept-model"><i class="fa fa-check"></i><b>6.4</b> Multilevel Modelling: Random Intercept Model</a><ul>
<li class="chapter" data-level="6.4.1" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#interpretation"><i class="fa fa-check"></i><b>6.4.1</b> Interpretation</a></li>
<li class="chapter" data-level="6.4.2" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#variance-partition-coefficient-vpc"><i class="fa fa-check"></i><b>6.4.2</b> Variance Partition Coefficient (VPC)</a></li>
<li class="chapter" data-level="6.4.3" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#uncertainty-of-estimates"><i class="fa fa-check"></i><b>6.4.3</b> Uncertainty of Estimates</a></li>
<li class="chapter" data-level="6.4.4" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#assessing-group-level-variation"><i class="fa fa-check"></i><b>6.4.4</b> Assessing Group-level Variation</a></li>
<li class="chapter" data-level="6.4.5" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#adding-individual-level-predictors"><i class="fa fa-check"></i><b>6.4.5</b> Adding Individual-level Predictors</a></li>
<li class="chapter" data-level="6.4.6" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#adding-group-level-predictors"><i class="fa fa-check"></i><b>6.4.6</b> Adding Group-level Predictors</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="multilevel-modelling-part-1.html"><a href="multilevel-modelling-part-1.html#useful-functions-1"><i class="fa fa-check"></i><b>6.5</b> Useful Functions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html"><i class="fa fa-check"></i><b>7</b> Multilevel Modelling - Part 2</a><ul>
<li class="chapter" data-level="7.1" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#dependencies-5"><i class="fa fa-check"></i><b>7.1</b> Dependencies</a></li>
<li class="chapter" data-level="7.2" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#data-4"><i class="fa fa-check"></i><b>7.2</b> Data</a></li>
<li class="chapter" data-level="7.3" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#conceptual-overview"><i class="fa fa-check"></i><b>7.3</b> Conceptual Overview</a><ul>
<li class="chapter" data-level="7.3.1" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#exploratory-analysis-varying-slopes"><i class="fa fa-check"></i><b>7.3.1</b> Exploratory Analysis: Varying Slopes</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#estimating-varying-intercept-and-slopes-models"><i class="fa fa-check"></i><b>7.4</b> Estimating Varying Intercept and Slopes Models</a></li>
<li class="chapter" data-level="7.5" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#interpreting-correlations-between-group-level-intercepts-and-slopes"><i class="fa fa-check"></i><b>7.5</b> Interpreting Correlations Between Group-level Intercepts and Slopes</a></li>
<li class="chapter" data-level="7.6" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#model-building"><i class="fa fa-check"></i><b>7.6</b> Model building</a><ul>
<li class="chapter" data-level="7.6.1" data-path="multilevel-modelling-part-2.html"><a href="multilevel-modelling-part-2.html#model-comparison"><i class="fa fa-check"></i><b>7.6.1</b> Model Comparison</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html"><i class="fa fa-check"></i><b>8</b> Geographically Weighted Regression</a><ul>
<li class="chapter" data-level="8.1" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#dependencies-6"><i class="fa fa-check"></i><b>8.1</b> Dependencies</a></li>
<li class="chapter" data-level="8.2" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#data-5"><i class="fa fa-check"></i><b>8.2</b> Data</a></li>
<li class="chapter" data-level="8.3" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#recap-spatial-effects"><i class="fa fa-check"></i><b>8.3</b> Recap: Spatial Effects</a></li>
<li class="chapter" data-level="8.4" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#exploratory-analysis"><i class="fa fa-check"></i><b>8.4</b> Exploratory Analysis</a></li>
<li class="chapter" data-level="8.5" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#global-regression"><i class="fa fa-check"></i><b>8.5</b> Global Regression</a><ul>
<li class="chapter" data-level="8.5.1" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#global-regression-results"><i class="fa fa-check"></i><b>8.5.1</b> Global Regression Results</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#fitting-a-geographically-weighted-regression"><i class="fa fa-check"></i><b>8.6</b> Fitting a Geographically Weighted Regression</a><ul>
<li class="chapter" data-level="8.6.1" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#fixed-or-adaptive-kernel"><i class="fa fa-check"></i><b>8.6.1</b> Fixed or Adaptive Kernel</a></li>
<li class="chapter" data-level="8.6.2" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#optimal-bandwidth"><i class="fa fa-check"></i><b>8.6.2</b> Optimal Bandwidth</a></li>
<li class="chapter" data-level="8.6.3" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#shape-of-spatial-kernel"><i class="fa fa-check"></i><b>8.6.3</b> Shape of Spatial Kernel</a></li>
<li class="chapter" data-level="8.6.4" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#selecting-a-bandwidth"><i class="fa fa-check"></i><b>8.6.4</b> Selecting a Bandwidth</a></li>
<li class="chapter" data-level="8.6.5" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#model-fit"><i class="fa fa-check"></i><b>8.6.5</b> Model fit</a></li>
<li class="chapter" data-level="8.6.6" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#interpretation-1"><i class="fa fa-check"></i><b>8.6.6</b> Interpretation</a></li>
<li class="chapter" data-level="8.6.7" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#assessing-statistical-significance"><i class="fa fa-check"></i><b>8.6.7</b> Assessing statistical significance</a></li>
<li class="chapter" data-level="8.6.8" data-path="geographically-weighted-regression.html"><a href="geographically-weighted-regression.html#collinearity-in-gwr"><i class="fa fa-check"></i><b>8.6.8</b> Collinearity in GWR</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html"><i class="fa fa-check"></i><b>9</b> Spatio-Temporal Analysis</a><ul>
<li class="chapter" data-level="9.1" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#dependencies-7"><i class="fa fa-check"></i><b>9.1</b> Dependencies</a></li>
<li class="chapter" data-level="9.2" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#data-6"><i class="fa fa-check"></i><b>9.2</b> Data</a></li>
<li class="chapter" data-level="9.3" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#why-spatio-temporal-analysis"><i class="fa fa-check"></i><b>9.3</b> Why Spatio-Temporal Analysis?</a><ul>
<li class="chapter" data-level="9.3.1" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#spatio-temporal-data-structures"><i class="fa fa-check"></i><b>9.3.1</b> Spatio-temporal Data Structures</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#data-wrangling"><i class="fa fa-check"></i><b>9.4</b> Data Wrangling</a></li>
<li class="chapter" data-level="9.5" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#exploring-spatio-temporal-data"><i class="fa fa-check"></i><b>9.5</b> Exploring Spatio-Temporal Data</a><ul>
<li class="chapter" data-level="9.5.1" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#visualisation"><i class="fa fa-check"></i><b>9.5.1</b> Visualisation</a></li>
<li class="chapter" data-level="9.5.2" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#exploratory-analysis-1"><i class="fa fa-check"></i><b>9.5.2</b> Exploratory Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#spatio-temporal-data-modelling"><i class="fa fa-check"></i><b>9.6</b> Spatio-Temporal Data Modelling</a><ul>
<li class="chapter" data-level="9.6.1" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#intuition"><i class="fa fa-check"></i><b>9.6.1</b> Intuition</a></li>
<li class="chapter" data-level="9.6.2" data-path="spatio-temporal-analysis.html"><a href="spatio-temporal-analysis.html#fitting-spatio-temporal-models"><i class="fa fa-check"></i><b>9.6.2</b> Fitting Spatio-Temporal Models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Analysis Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-econometrics" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Spatial Econometrics</h1>
<p>This chapter<a href="#fn25" class="footnoteRef" id="fnref25"><sup>25</sup></a> is based on the following references, which are good follow-up’s on the topic:</p>
<ul>
<li><a href="http://darribas.org/sdar_mini/notes/Class_03.html">Session III</a> of <span class="citation">Arribas-Bel (<a href="#ref-arribas2014spatial">2014</a>)</span>. Check the “Related readings” section on the session page for more in-depth discussions.</li>
<li><span class="citation">Anselin (<a href="#ref-anselin2005spatial">2007</a>)</span>, freely available to download [<a href="http://csiss.org/GISPopSci/workshops/2011/PSU/readings/W15_Anselin2007.pdf"><code>pdf</code></a>].</li>
<li>The second part of this tutorial assumes you have reviewed Lecture 5 of <span class="citation">Arribas-Bel (<a href="#ref-darribas_gds19">2019</a>)</span>. [<a href="http://darribas.org/gds19/notes/Class_05.html">html</a>]</li>
<li>A similar coverage of topics is presented in Chapter 11 of the upcoming book “Geographic Data Science with Python”, which is currently in progress. [<a href="https://geographicdata.science/book/notebooks/11_regression.html"><code>url</code></a>]</li>
</ul>
<p>This tutorial is part of <a href="index.html">Spatial Analysis Notes</a>, a compilation hosted as a GitHub repository that you can access it in a few ways:</p>
<ul>
<li>As a <a href="https://github.com/GDSL-UL/san/archive/master.zip">download</a> of a <code>.zip</code> file that contains all the materials.</li>
<li>As an <a href="https://gdsl-ul.github.io/san/spatial-econometrics.html">html website</a>.</li>
<li>As a <a href="https://gdsl-ul.github.io/san/spatial_analysis_notes.pdf">pdf document</a></li>
<li>As a <a href="https://github.com/GDSL-UL/san">GitHub repository</a>.</li>
</ul>
<div id="dependencies-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Dependencies</h2>
<p>The illustration below relies on the following libraries that you will need to have installed on your machine to be able to interactively follow along<a href="#fn26" class="footnoteRef" id="fnref26"><sup>26</sup></a>. Once installed, load them up with the following commands:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Layout</span>
<span class="kw">library</span>(tufte)
<span class="co"># For pretty table</span>
<span class="kw">library</span>(knitr)
<span class="co"># Spatial Data management</span>
<span class="kw">library</span>(rgdal)</code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## rgdal: version: 1.4-8, (SVN revision 845)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.4.2, released 2019/06/28
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 5.2.0, September 15th, 2018, [PJ_VERSION: 520]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pretty graphics</span>
<span class="kw">library</span>(ggplot2)
<span class="co"># Pretty maps</span>
<span class="kw">library</span>(ggmap)</code></pre></div>
<pre><code>## Google&#39;s Terms of Service: https://cloud.google.com/maps-platform/terms/.</code></pre>
<pre><code>## Please cite ggmap if you use it! See citation(&quot;ggmap&quot;) for details.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Various GIS utilities</span>
<span class="kw">library</span>(GISTools)</code></pre></div>
<pre><code>## Loading required package: maptools</code></pre>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<pre><code>## Loading required package: RColorBrewer</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## Warning: package &#39;MASS&#39; was built under R version 3.6.2</code></pre>
<pre><code>## Loading required package: rgeos</code></pre>
<pre><code>## rgeos version: 0.5-2, (SVN revision 621)
##  GEOS runtime version: 3.7.2-CAPI-1.11.2 
##  Linking to sp version: 1.3-1 
##  Polygon checking: TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For all your interpolation needs</span>
<span class="kw">library</span>(gstat)
<span class="co"># For data manipulation</span>
<span class="kw">library</span>(plyr)
<span class="co"># Spatial regression</span>
<span class="kw">library</span>(spdep)</code></pre></div>
<pre><code>## Loading required package: spData</code></pre>
<pre><code>## To access larger datasets in this package, install the spDataLarge
## package with: `install.packages(&#39;spDataLarge&#39;,
## repos=&#39;https://nowosad.github.io/drat/&#39;, type=&#39;source&#39;)`</code></pre>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<p>Before we start any analysis, let us set the path to the directory where we are working. We can easily do that with <code>setwd()</code>. Please replace in the following line the path to the folder where you have placed this file -and where the <code>house_transactions</code> folder with the data lives.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#setwd(&#39;/media/dani/baul/AAA/Documents/teaching/u-lvl/2016/envs453/code/GIT/kde_idw_r/&#39;)</span>
<span class="kw">setwd</span>(<span class="st">&#39;.&#39;</span>)</code></pre></div>
</div>
<div id="data-2" class="section level2">
<h2><span class="header-section-number">5.2</span> Data</h2>
<p>To explore ideas in spatial regression, we will be using house price data for the municipality of Liverpool. Our main dataset is provided by the Land Registry (as part of their <a href="https://www.gov.uk/government/collections/price-paid-data">Price Paid Data</a>) but has been cleaned and re-packaged into a shapefile by Dani Arribas-Bel.</p>
<p>Let us load it up first of all:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hst &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="st">&#39;data/house_transactions&#39;</span>, <span class="dt">layer =</span> <span class="st">&#39;liv_house_trans&#39;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/Franciscorowe/Dropbox/Francisco/uol/teaching/envs453/201920/lectures/san/data/house_transactions&quot;, layer: &quot;liv_house_trans&quot;
## with 6324 features
## It has 18 fields
## Integer64 fields read as strings:  price</code></pre>
<p>The tabular component of the spatial frame contains the followig variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(hst)</code></pre></div>
<pre><code>##  [1] &quot;pcds&quot;       &quot;id&quot;         &quot;price&quot;      &quot;trans_date&quot; &quot;type&quot;      
##  [6] &quot;new&quot;        &quot;duration&quot;   &quot;paon&quot;       &quot;saon&quot;       &quot;street&quot;    
## [11] &quot;locality&quot;   &quot;town&quot;       &quot;district&quot;   &quot;county&quot;     &quot;ppd_cat&quot;   
## [16] &quot;status&quot;     &quot;lsoa11&quot;     &quot;LSOA11CD&quot;</code></pre>
<p>The meaning for most of the variables can be found in the original <a href="https://www.gov.uk/guidance/about-the-price-paid-data#explanations-of-column-headers-in-the-ppd">Land Registry documentation</a>. The dataset contains transactions that took place during 2,014:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Format dates</span>
dts &lt;-<span class="st"> </span><span class="kw">as.Date</span>(hst<span class="op">@</span>data<span class="op">$</span>trans_date)
<span class="co"># Set up summary table</span>
tab &lt;-<span class="st"> </span><span class="kw">summary</span>(dts)
tab</code></pre></div>
<pre><code>##         Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
## &quot;2014-01-02&quot; &quot;2014-04-11&quot; &quot;2014-07-09&quot; &quot;2014-07-08&quot; &quot;2014-10-03&quot; &quot;2014-12-30&quot;</code></pre>
<p>Although the original Land Registry data contain some characteristics of the house, all of them are categorical: <em>is the house newly built? What type of property is it?</em> To bring in a richer picture and illustrate how continuous variables can also be included in a spatial setting, we will augment the original transaction data with Deprivation indices from the <a href="https://data.cdrc.ac.uk/dataset/cdrc-english-indices-of-deprivation-2015-geodata-pack-liverpool-e08000012">CDRC</a> at the <a href="http://neighbourhood.statistics.gov.uk/HTMLDocs/nessgeography/superoutputareasexplained/output-areas-explained.htm">Lower Layer Super Output Area</a> (LSOA) level.</p>
<p>Let us read the <code>csv</code> in:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imd &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/house_transactions/E08000012.csv&#39;</span>)</code></pre></div>
<p>The table contains not only the overall IMD score and rank, but some of the component scores, as well as the <code>LSOA</code> code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(imd)</code></pre></div>
<pre><code>##  [1] &quot;LSOA11CD&quot;   &quot;imd_rank&quot;   &quot;imd_score&quot;  &quot;income&quot;     &quot;employment&quot;
##  [6] &quot;education&quot;  &quot;health&quot;     &quot;crime&quot;      &quot;housing&quot;    &quot;living_env&quot;
## [11] &quot;idaci&quot;      &quot;idaopi&quot;</code></pre>
<p>That bit of information, <code>LSOA11CD</code>, is crucial to be able to connect it to each house transaction. To “join” both tables, we can use the base command <code>merge</code>, which will assign values from <code>imd</code> into <code>hst</code> making sure that each house transaction get the IMD data for the LSOA where it is located:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db &lt;-<span class="st"> </span><span class="kw">merge</span>(hst, imd)</code></pre></div>
<p>The resulting table, <code>db</code>, contains variables from both original tables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(db)</code></pre></div>
<pre><code>##  [1] &quot;LSOA11CD&quot;   &quot;pcds&quot;       &quot;id&quot;         &quot;price&quot;      &quot;trans_date&quot;
##  [6] &quot;type&quot;       &quot;new&quot;        &quot;duration&quot;   &quot;paon&quot;       &quot;saon&quot;      
## [11] &quot;street&quot;     &quot;locality&quot;   &quot;town&quot;       &quot;district&quot;   &quot;county&quot;    
## [16] &quot;ppd_cat&quot;    &quot;status&quot;     &quot;lsoa11&quot;     &quot;imd_rank&quot;   &quot;imd_score&quot; 
## [21] &quot;income&quot;     &quot;employment&quot; &quot;education&quot;  &quot;health&quot;     &quot;crime&quot;     
## [26] &quot;housing&quot;    &quot;living_env&quot; &quot;idaci&quot;      &quot;idaopi&quot;</code></pre>
<p>Since we will heavily rely on <code>price</code>, we need to turn it into a numeric column, rather than as a factor, which is how it is picked up:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db<span class="op">@</span>data<span class="op">$</span>price &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(db<span class="op">@</span>data<span class="op">$</span>price))</code></pre></div>
<p>For some of our analysis, we will need the coarse postcode of each house, rather than the finely specified one in the original data. This means using the available one</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(db<span class="op">@</span>data[<span class="st">&#39;pcds&#39;</span>])</code></pre></div>
<pre><code>##      pcds
## 62 L1 0AB
## 63 L1 0AB
## 64 L1 0AB
## 65 L1 0AB
## 66 L1 0AB
## 67 L1 0AB</code></pre>
<p>to create a new column that only contains the first bit of the postcode (<code>L1</code> in the examples above). The following lines of code will do that for us:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db<span class="op">$</span>pc &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(<span class="kw">as.character</span>(db<span class="op">$</span>pcds), <span class="dt">split=</span><span class="st">&quot; &quot;</span>), <span class="st">&quot;[&quot;</span>, <span class="dv">1</span>))</code></pre></div>
<p>Given there are 6,324 transactions in the dataset, a simple plot of the point coordinates implicitly draws the shape of the Liverpool municipality:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(db)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-13"></span>
<img src="04-spatial_econometrics_files/figure-html/unnamed-chunk-13-1.png" alt="Spatial distribution of house transactions in Liverpool" width="672" />
<p class="caption">
Figure 3.6: Spatial distribution of house transactions in Liverpool
</p>
</div>
</div>
<div id="non-spatial-regression-a-refresh" class="section level2">
<h2><span class="header-section-number">5.3</span> Non-spatial regression, a refresh</h2>
<p>Before we discuss how to explicitly include space into the linear regression framework, let us show how basic regression can be carried out in R, and how you can begin to interpret the results. By no means is this a formal and complete introduction to regression so, if that is what you are looking for, I suggest the first part of <span class="citation">Gelman and Hill (<a href="#ref-gelman2006data">2006</a><a href="#ref-gelman2006data">a</a>)</span>, in particular chapters 3 and 4.</p>
<p>The core idea of linear regression is to explain the variation in a given (<em>dependent</em>) variable as a linear function of a series of other (<em>explanatory</em>) variables. For example, in our case, we may want to express/explain the price of a house as a function of whether it is new and the degree of deprivation of the area where it is located. At the individual level, we can express this as:</p>
<p><span class="math display">\[
P_i = \alpha + \beta_1 NEW_i + \beta_2 IMD_i + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(P_i\)</span> is the price of house <span class="math inline">\(i\)</span>, <span class="math inline">\(NEW_i\)</span> is a binary variable that takes one if the house is newly built or zero otherwise and <span class="math inline">\(IMD_i\)</span> is the IMD score of the LSOA where <span class="math inline">\(i\)</span> is located. The parameters <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, and <span class="math inline">\(\beta_3\)</span> give us information about in which way and to what extent each variable is related to the price, and <span class="math inline">\(\alpha\)</span>, the constant term, is the average house price when all the other variables are zero. The term <span class="math inline">\(\epsilon_i\)</span> is usually referred to as “error” and captures elements that influence the price of a house but are not whether the house is new or the IMD score of its area. We can also express this relation in matrix form, excluding subindices for <span class="math inline">\(i\)</span><a href="#fn27" class="footnoteRef" id="fnref27"><sup>27</sup></a>.</p>
<p>Essentially, a regression can be seen as a multivariate extension of simple bivariate correlations. Indeed, one way to interpret the <span class="math inline">\(\beta_k\)</span> coefficients in the equation above is as the degree of correlation between the explanatory variable <span class="math inline">\(k\)</span> and the dependent variable, <em>keeping all the other explanatory variables constant</em>. When you calculate simple bivariate correlations, the coefficient of a variable is picking up the correlation between the variables, but it is also subsuming into it variation associated with other correlated variables –also called confounding factors<a href="#fn28" class="footnoteRef" id="fnref28"><sup>28</sup></a>. Regression allows you to isolate the distinct effect that a single variable has on the dependent one, once we <em>control</em> for those other variables.</p>
<p>Practically speaking, running linear regressions in <code>R</code> is straightforward. For example, to fit the model specified in the equation above, we only need one line of code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;price ~ new + imd_score&#39;</span>, db)</code></pre></div>
<p>We use the command <code>lm</code>, for linear model, and specify the equation we want to fit using a string that relates the dependent variable (<code>price</code>) with a set of explanatory ones (<code>new</code> and <code>price</code>) by using a tilde <code>~</code> that is akin the <span class="math inline">\(=\)</span> symbol in the mathematical equation. Since we are using names of variables that are stored in a table, we need to pass the table object (<code>db</code>) as well.</p>
<p>In order to inspect the results of the model, the quickest way is to call <code>summary</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m1)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;price ~ new + imd_score&quot;, data = db)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
##  -184254   -59948   -29032    11430 26434741 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   235596      13326  17.679  &lt; 2e-16 ***
## newY            4926      19104   0.258    0.797    
## imd_score      -2416        308  -7.843 5.12e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 509000 on 6321 degrees of freedom
## Multiple R-squared:  0.009712,   Adjusted R-squared:  0.009398 
## F-statistic: 30.99 on 2 and 6321 DF,  p-value: 4.027e-14</code></pre>
<p>A full detailed explanation of the output is beyond the scope of this note, so we will focus on the relevant bits for our main purpose. This is concentrated on the <code>Coefficients</code> section, which gives us the estimates for the <span class="math inline">\(\beta_k\)</span> coefficients in our model. Or, in other words, the coefficients are the raw equivalent of the correlation coefficient between each explanatory variable and the dependent one, once the polluting effect of confounding factors has been accounted for<a href="#fn29" class="footnoteRef" id="fnref29"><sup>29</sup></a>. Results are as expected for the most part: houses tend to be significantly more expensive in areas with lower deprivation (an average of GBP2,416 for every additional score); and a newly built house is on average GBP4,926 more expensive, although this association cannot be ruled out to be random (probably due to the small relative number of new houses).</p>
<p>Finally, before we jump into introducing space in our models, let us modify our equation slightly to make it more useful when it comes to interpretating it. Many house price models in the literature is estimated in log-linear terms:</p>
<p><span class="math display">\[
\log{P_i} = \alpha + \beta_1 NEW_i + \beta_2 IMD_i + \epsilon_i
\]</span></p>
<p>This allows to interpret the coefficients more directly: as the percentual change induced by a unit increase in the explanatory variable of the estimate. To fit such a model, we can specify the logarithm of a given variable directly in the formula.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;log(price) ~ new + imd_score&#39;</span>, db)
<span class="kw">summary</span>(m2)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;log(price) ~ new + imd_score&quot;, data = db)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.3172 -0.3231 -0.0149  0.3063  5.2769 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 12.2037784  0.0138634  880.28   &lt;2e-16 ***
## newY         0.2456446  0.0198740   12.36   &lt;2e-16 ***
## imd_score   -0.0169702  0.0003204  -52.96   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5295 on 6321 degrees of freedom
## Multiple R-squared:  0.3101, Adjusted R-squared:  0.3099 
## F-statistic:  1421 on 2 and 6321 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Looking at the results we can see a couple of differences with respect to the original specification. First, the estimates are substantially different numbers. This is because, although they consider the same variable, the look at it from different angles, and provide different interpretations. For example, the coefficient for the IMD, instead of being interpretable in terms of GBP, the unit of the dependent variable, it represents a percentage: a unit increase in the degree of deprivation is associated with a 0.2% decrease in the price of a house.<a href="#fn30" class="footnoteRef" id="fnref30"><sup>30</sup></a> Second, the variable <code>new</code> is significant in this case. This is probably related to the fact that, by taking logs, we are also making the dependent variable look more normal (Gaussian) and that allows the linear model to provide a better fit and, hence, more accurate estimates. In this case, a house being newly built, as compared to an old house, is overall 25% more expensive.</p>
</div>
<div id="spatial-regression-a-very-first-dip" class="section level2">
<h2><span class="header-section-number">5.4</span> Spatial regression: a (very) first dip</h2>
<p>Spatial regression is about <em>explicitly</em> introducing space or geographical context into the statistical framework of a regression. Conceptually, we want to introduce space into our model whenever we think it plays an important role in the process we are interested in, or when space can act as a reasonable proxy for other factors we cannot but should include in our model. As an example of the former, we can imagine how houses at the seafront are probably more expensive than those in the second row, given their better views. To illustrate the latter, we can think of how the character of a neighborhood is important in determining the price of a house; however, it is very hard to identify and quantify “character” perse, although it might be easier to get at its spatial variation, hence a case of space as a proxy.</p>
<p>Spatial regression is a large field of development in the econometrics and statistics literatures. In this brief introduction, we will consider two related but very different processes that give rise to spatial effects: spatial heterogeneity and spatial dependence. For more rigorous treatments of the topics introduced here, the reader is referred to <span class="citation">Anselin (<a href="#ref-anselin2003spatial">2003</a>)</span>, <span class="citation">Anselin and Rey (<a href="#ref-anselin2014modern">2014</a>)</span>, and <span class="citation">Gibbons, Overman, and Patacchini (<a href="#ref-gibbons2014spatial">2014</a>)</span>.</p>
</div>
<div id="spatial-heterogeneity" class="section level2">
<h2><span class="header-section-number">5.5</span> Spatial heterogeneity</h2>
<p>Spatial heterogeneity (SH) arises when we cannot safely assume the process we are studying operates under the same “rules” throughout the geography of interest. In other words, we can observe SH when there are effects on the outcome variable that are intrinsically linked to specific locations. A good example of this is the case of seafront houses above: we are trying to model the price of a house and, the fact some houses are located under certain conditions (i.e. by the sea), makes their price behave differently<a href="#fn31" class="footnoteRef" id="fnref31"><sup>31</sup></a>.</p>
<p>This somewhat abstract concept of SH can be made operational in a model in several ways. We will explore the following two: spatial fixed-effects (FE); and spatial regimes, which is a generalization of FE.</p>
<p><strong>Spatial FE</strong></p>
<p>Let us consider the house price example from the previous section to introduce a more general illustration that relates to the second motivation for spatial effects (“space as a proxy”). Given we are only including two explanatory variables in the model, it is likely we are missing some important factors that play a role at determining the price at which a house is sold. Some of them, however, are likely to vary systematically over space (e.g. different neighborhood characteristics). If that is the case, we can control for those unobserved factors by using traditional dummy variables but basing their creation on a spatial rule. For example, let us include a binary variable for every two-digit postcode in Liverpool, indicating whether a given house is located within such area (<code>1</code>) or not (<code>0</code>). Mathematically, we are now fitting the following equation:</p>
<p><span class="math display">\[
\log{P_i} = \alpha_r + \beta_1 NEW_i + \beta_2 IMD_i + \epsilon_i
\]</span></p>
<p>where the main difference is that we are now allowing the constant term, <span class="math inline">\(\alpha\)</span>, to vary by postcode <span class="math inline">\(r\)</span>, <span class="math inline">\(\alpha_r\)</span>.</p>
<p>Programmatically, this is straightforward to estimate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Include `-1` to eliminate the constant term and include a dummy for every area</span>
m3 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;log(price) ~ pc + new + imd_score - 1&#39;</span>, db)
<span class="kw">summary</span>(m3)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;log(price) ~ pc + new + imd_score - 1&quot;, data = db)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2680 -0.2833 -0.0235  0.2599  5.6714 
## 
## Coefficients:
##            Estimate Std. Error t value Pr(&gt;|t|)    
## pcL1      11.697166   0.032137  363.98   &lt;2e-16 ***
## pcL10     11.893524   0.076471  155.53   &lt;2e-16 ***
## pcL11     11.902319   0.043194  275.55   &lt;2e-16 ***
## pcL12     12.065776   0.029692  406.37   &lt;2e-16 ***
## pcL13     11.865523   0.034893  340.06   &lt;2e-16 ***
## pcL14     11.920922   0.044480  268.01   &lt;2e-16 ***
## pcL15     12.039916   0.028555  421.64   &lt;2e-16 ***
## pcL16     12.295535   0.034950  351.81   &lt;2e-16 ***
## pcL17     12.275339   0.027978  438.75   &lt;2e-16 ***
## pcL18     12.396475   0.024534  505.27   &lt;2e-16 ***
## pcL19     12.162630   0.029697  409.56   &lt;2e-16 ***
## pcL2      12.061443   0.100805  119.65   &lt;2e-16 ***
## pcL20     11.928142   0.226932   52.56   &lt;2e-16 ***
## pcL24     11.868363   0.045785  259.22   &lt;2e-16 ***
## pcL25     12.234462   0.028557  428.42   &lt;2e-16 ***
## pcL27     12.035241   0.092832  129.65   &lt;2e-16 ***
## pcL28     11.438267   0.206323   55.44   &lt;2e-16 ***
## pcL3      11.954453   0.029561  404.40   &lt;2e-16 ***
## pcL4      11.718609   0.039575  296.11   &lt;2e-16 ***
## pcL5      12.037267   0.055952  215.14   &lt;2e-16 ***
## pcL6      11.898506   0.042918  277.24   &lt;2e-16 ***
## pcL7      11.855374   0.044681  265.33   &lt;2e-16 ***
## pcL8      12.034093   0.039801  302.36   &lt;2e-16 ***
## pcL9      11.759056   0.033610  349.87   &lt;2e-16 ***
## newY       0.310829   0.020947   14.84   &lt;2e-16 ***
## imd_score -0.012008   0.000517  -23.23   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5007 on 6298 degrees of freedom
## Multiple R-squared:  0.9981, Adjusted R-squared:  0.9981 
## F-statistic: 1.305e+05 on 26 and 6298 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Econometrically speaking, what the postcode FE we have introduced imply is that, instead of comparing all house prices across Liverpool as equal, we only derive variation from within each postcode<a href="#fn32" class="footnoteRef" id="fnref32"><sup>32</sup></a>. Remember that the interpretation of a <span class="math inline">\(\beta_k\)</span> coefficient is the effect of variable <span class="math inline">\(k\)</span>, <em>given all the other explanatory variables included remain constant</em>. By including a single variable for each area, we are effectively forcing the model to compare as equal only house prices that share the same value for each variable; in other words, only houses located within the same area. Introducing FE affords you a higher degree of isolation of the effects of the variables you introduce in your model because you can control for unobserved effects that align spatially with the distribution of the FE you introduce (by postcode, in our case).</p>
<p><strong>Spatial regimes</strong></p>
<p>At the core of estimating spatial FEs is the idea that, instead of assuming the dependent variable behaves uniformly over space, there are systematic effects following a geographical pattern that affect its behaviour. In other words, spatial FEs introduce econometrically the notion of spatial heterogeneity. They do this in the simplest possible form: by allowing the constant term to vary geographically. The other elements of the regression are left untouched and hence apply uniformly across space. The idea of spatial regimes (SRs) is to generalize the spatial FE approach to allow not only the constant term to vary but also any other explanatory variable. This implies that the equation we will be estimating is:</p>
<p><span class="math display">\[
\log{P_i} = \alpha_r + \beta_{1r} NEW_i + \beta_{2r} IMD_i + \epsilon_i
\]</span></p>
<p>where we are not only allowing the constant term to vary by region (<span class="math inline">\(\alpha_r\)</span>), but also every other parameter (<span class="math inline">\(\beta_{kr}\)</span>).</p>
<p>In R terms, this is more straightforward to estimate if <code>new</code> is expressed as <code>0</code> and <code>1</code>, rather than as factors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a new variable `newB` to store the binary form of `new`</span>
db<span class="op">@</span>data<span class="op">$</span>newB &lt;-<span class="st"> </span><span class="dv">1</span>
db[db<span class="op">@</span>data<span class="op">$</span>new<span class="op">==</span><span class="st">&#39;N&#39;</span>, <span class="st">&#39;newB&#39;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre></div>
<p>Also, given we are going to allow <em>every</em> coefficient to vary by regime, we will need to explicitly set a constant term that we can allow to vary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db<span class="op">$</span>one &lt;-<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>Then, the estimation leverages the capabilities in model description of R formulas:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># `:` notation implies interaction variables</span>
m4 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;log(price) ~ 0 +(one + newB + imd_score):(pc)&#39;</span>, db)
<span class="kw">summary</span>(m4)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;log(price) ~ 0 +(one + newB + imd_score):(pc)&quot;, 
##     data = db)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2051 -0.2506 -0.0182  0.2198  5.3507 
## 
## Coefficients: (8 not defined because of singularities)
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## one:pcL1        11.983460   0.098675 121.444  &lt; 2e-16 ***
## one:pcL10       11.911281   0.504210  23.624  &lt; 2e-16 ***
## one:pcL11       11.774865   0.160864  73.198  &lt; 2e-16 ***
## one:pcL12       12.157627   0.068165 178.356  &lt; 2e-16 ***
## one:pcL13       11.821576   0.103946 113.728  &lt; 2e-16 ***
## one:pcL14       11.821895   0.115040 102.763  &lt; 2e-16 ***
## one:pcL15       12.317524   0.052051 236.645  &lt; 2e-16 ***
## one:pcL16       12.761711   0.098709 129.287  &lt; 2e-16 ***
## one:pcL17       12.240652   0.065074 188.103  &lt; 2e-16 ***
## one:pcL18       12.695103   0.056510 224.654  &lt; 2e-16 ***
## one:pcL19       12.489604   0.054177 230.533  &lt; 2e-16 ***
## one:pcL2        12.164848   0.321558  37.831  &lt; 2e-16 ***
## one:pcL20       11.069199   0.211083  52.440  &lt; 2e-16 ***
## one:pcL24       10.876938   0.135326  80.376  &lt; 2e-16 ***
## one:pcL25       12.427878   0.051147 242.982  &lt; 2e-16 ***
## one:pcL27       11.022835   0.435730  25.297  &lt; 2e-16 ***
## one:pcL28       11.300143   1.126387  10.032  &lt; 2e-16 ***
## one:pcL3        11.977708   0.054781 218.647  &lt; 2e-16 ***
## one:pcL4        11.653464   0.109113 106.802  &lt; 2e-16 ***
## one:pcL5        11.544085   0.277000  41.675  &lt; 2e-16 ***
## one:pcL6        11.574617   0.158022  73.247  &lt; 2e-16 ***
## one:pcL7        11.617544   0.128402  90.478  &lt; 2e-16 ***
## one:pcL8        11.586224   0.085036 136.251  &lt; 2e-16 ***
## one:pcL9        11.837544   0.080452 147.139  &lt; 2e-16 ***
## newB:pcL1       -0.298430   0.051078  -5.843 5.40e-09 ***
## newB:pcL10             NA         NA      NA       NA    
## newB:pcL11       0.672479   0.089894   7.481 8.40e-14 ***
## newB:pcL12       0.977903   0.114281   8.557  &lt; 2e-16 ***
## newB:pcL13      -0.659910   0.473773  -1.393 0.163705    
## newB:pcL14       0.610482   0.132911   4.593 4.45e-06 ***
## newB:pcL15       0.744844   0.139732   5.331 1.01e-07 ***
## newB:pcL16             NA         NA      NA       NA    
## newB:pcL17      -0.094580   0.095188  -0.994 0.320449    
## newB:pcL18      -0.197115   0.122109  -1.614 0.106521    
## newB:pcL19       0.393901   0.089607   4.396 1.12e-05 ***
## newB:pcL2              NA         NA      NA       NA    
## newB:pcL20             NA         NA      NA       NA    
## newB:pcL24       0.735316   0.072739  10.109  &lt; 2e-16 ***
## newB:pcL25       0.196018   0.144527   1.356 0.175063    
## newB:pcL27       0.356678   0.189946   1.878 0.060457 .  
## newB:pcL28             NA         NA      NA       NA    
## newB:pcL3       -0.261461   0.055228  -4.734 2.25e-06 ***
## newB:pcL4        1.087380   0.079152  13.738  &lt; 2e-16 ***
## newB:pcL5        0.519945   0.094850   5.482 4.38e-08 ***
## newB:pcL6        0.695856   0.062461  11.141  &lt; 2e-16 ***
## newB:pcL7              NA         NA      NA       NA    
## newB:pcL8        0.334517   0.059368   5.635 1.83e-08 ***
## newB:pcL9              NA         NA      NA       NA    
## imd_score:pcL1  -0.010489   0.003383  -3.101 0.001938 ** 
## imd_score:pcL10 -0.012413   0.011381  -1.091 0.275485    
## imd_score:pcL11 -0.010637   0.003005  -3.540 0.000404 ***
## imd_score:pcL12 -0.017296   0.002625  -6.588 4.81e-11 ***
## imd_score:pcL13 -0.011004   0.002185  -5.036 4.89e-07 ***
## imd_score:pcL14 -0.010432   0.002469  -4.225 2.42e-05 ***
## imd_score:pcL15 -0.020737   0.001413 -14.681  &lt; 2e-16 ***
## imd_score:pcL16 -0.050522   0.007703  -6.559 5.85e-11 ***
## imd_score:pcL17 -0.009763   0.002214  -4.410 1.05e-05 ***
## imd_score:pcL18 -0.032289   0.003799  -8.499  &lt; 2e-16 ***
## imd_score:pcL19 -0.024629   0.001860 -13.242  &lt; 2e-16 ***
## imd_score:pcL2  -0.016601   0.013654  -1.216 0.224084    
## imd_score:pcL20        NA         NA      NA       NA    
## imd_score:pcL24  0.004090   0.002391   1.711 0.087139 .  
## imd_score:pcL25 -0.020461   0.001981 -10.327  &lt; 2e-16 ***
## imd_score:pcL27  0.006626   0.007561   0.876 0.380911    
## imd_score:pcL28 -0.009473   0.020367  -0.465 0.641850    
## imd_score:pcL3  -0.006935   0.001747  -3.970 7.28e-05 ***
## imd_score:pcL4  -0.012032   0.001731  -6.952 3.96e-12 ***
## imd_score:pcL5  -0.006051   0.004009  -1.509 0.131280    
## imd_score:pcL6  -0.008324   0.002367  -3.517 0.000440 ***
## imd_score:pcL7  -0.007517   0.002342  -3.209 0.001337 ** 
## imd_score:pcL8  -0.004064   0.001561  -2.603 0.009255 ** 
## imd_score:pcL9  -0.014124   0.002052  -6.882 6.47e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.472 on 6260 degrees of freedom
## Multiple R-squared:  0.9984, Adjusted R-squared:  0.9983 
## F-statistic: 5.966e+04 on 64 and 6260 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>As we can see, there are a few <code>NA</code> values (e.g. <code>pcL10</code>). This has to do with the fact that there are not that many new houses, so some of the buckets in which the regimes split the data to estimate each parameter are empty. This can be readily seen by obtaining a quick cross tabulation of <code>pc</code> and <code>new</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(db<span class="op">$</span>pc, db<span class="op">$</span>new)</code></pre></div>
<pre><code>##      
##         N   Y
##   L1  161 189
##   L10  47   0
##   L11 192  34
##   L12 326  18
##   L13 387   1
##   L14 144  19
##   L15 466  12
##   L16 212   0
##   L17 398  27
##   L18 439  16
##   L19 329  32
##   L2   25   0
##   L20   5   0
##   L24  97  84
##   L25 357  11
##   L27  22  10
##   L28   6   0
##   L3  272 101
##   L4  437  41
##   L5   97  46
##   L6  319  78
##   L7  201   0
##   L8  227 110
##   L9  329   0</code></pre>
<p>To illustrate a correct regime estimation, we can focus only on <code>imd_score</code><a href="#fn33" class="footnoteRef" id="fnref33"><sup>33</sup></a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># `:` notation implies interaction variables</span>
m5 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;log(price) ~ 0 + (one + imd_score):pc&#39;</span>, db)
<span class="kw">summary</span>(m5)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;log(price) ~ 0 + (one + imd_score):pc&quot;, data = db)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.4952 -0.2779 -0.0221  0.2477  5.4973 
## 
## Coefficients: (1 not defined because of singularities)
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## one:pcL1        11.8965065  0.1030279 115.469  &lt; 2e-16 ***
## one:pcL10       11.9112807  0.5325447  22.367  &lt; 2e-16 ***
## one:pcL11       11.6203268  0.1684973  68.964  &lt; 2e-16 ***
## one:pcL12       12.2106579  0.0716973 170.309  &lt; 2e-16 ***
## one:pcL13       11.8099973  0.1094358 107.917  &lt; 2e-16 ***
## one:pcL14       12.1229804  0.0998496 121.412  &lt; 2e-16 ***
## one:pcL15       12.3753226  0.0537697 230.154  &lt; 2e-16 ***
## one:pcL16       12.7617106  0.1042555 122.408  &lt; 2e-16 ***
## one:pcL17       12.2248054  0.0666348 183.460  &lt; 2e-16 ***
## one:pcL18       12.7033951  0.0594382 213.724  &lt; 2e-16 ***
## one:pcL19       12.4767606  0.0571384 218.360  &lt; 2e-16 ***
## one:pcL2        12.1648479  0.3396283  35.818  &lt; 2e-16 ***
## one:pcL20       11.0691989  0.2229447  49.650  &lt; 2e-16 ***
## one:pcL24       11.5214275  0.1260747  91.386  &lt; 2e-16 ***
## one:pcL25       12.4351502  0.0537240 231.464  &lt; 2e-16 ***
## one:pcL27       11.3770205  0.4148632  27.424  &lt; 2e-16 ***
## one:pcL28       11.3001428  1.1896847   9.498  &lt; 2e-16 ***
## one:pcL3        11.8873513  0.0542344 219.185  &lt; 2e-16 ***
## one:pcL4        11.4097020  0.1137109 100.340  &lt; 2e-16 ***
## one:pcL5        10.9973874  0.2729459  40.291  &lt; 2e-16 ***
## one:pcL6        11.1816689  0.1626918  68.729  &lt; 2e-16 ***
## one:pcL7        11.6175445  0.1356173  85.664  &lt; 2e-16 ***
## one:pcL8        11.5086161  0.0886286 129.852  &lt; 2e-16 ***
## one:pcL9        11.8375435  0.0849726 139.310  &lt; 2e-16 ***
## imd_score:pcL1  -0.0131286  0.0035407  -3.708 0.000211 ***
## imd_score:pcL10 -0.0124128  0.0120210  -1.033 0.301837    
## imd_score:pcL11 -0.0058373  0.0031009  -1.882 0.059824 .  
## imd_score:pcL12 -0.0173734  0.0027727  -6.266 3.95e-10 ***
## imd_score:pcL13 -0.0107902  0.0023022  -4.687 2.83e-06 ***
## imd_score:pcL14 -0.0160870  0.0022604  -7.117 1.23e-12 ***
## imd_score:pcL15 -0.0219205  0.0014734 -14.878  &lt; 2e-16 ***
## imd_score:pcL16 -0.0505217  0.0081354  -6.210 5.63e-10 ***
## imd_score:pcL17 -0.0093980  0.0023061  -4.075 4.65e-05 ***
## imd_score:pcL18 -0.0333885  0.0039476  -8.458  &lt; 2e-16 ***
## imd_score:pcL19 -0.0228257  0.0019160 -11.913  &lt; 2e-16 ***
## imd_score:pcL2  -0.0166013  0.0144213  -1.151 0.249707    
## imd_score:pcL20         NA         NA      NA       NA    
## imd_score:pcL24 -0.0020546  0.0024420  -0.841 0.400163    
## imd_score:pcL25 -0.0205241  0.0020921  -9.810  &lt; 2e-16 ***
## imd_score:pcL27  0.0020943  0.0075687   0.277 0.782014    
## imd_score:pcL28 -0.0094733  0.0215112  -0.440 0.659671    
## imd_score:pcL3  -0.0061811  0.0018374  -3.364 0.000773 ***
## imd_score:pcL4  -0.0066455  0.0017803  -3.733 0.000191 ***
## imd_score:pcL5   0.0039338  0.0037726   1.043 0.297115    
## imd_score:pcL6  -0.0004620  0.0023860  -0.194 0.846480    
## imd_score:pcL7  -0.0075165  0.0024737  -3.039 0.002387 ** 
## imd_score:pcL8  -0.0006921  0.0015228  -0.455 0.649469    
## imd_score:pcL9  -0.0141241  0.0021676  -6.516 7.79e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4985 on 6277 degrees of freedom
## Multiple R-squared:  0.9982, Adjusted R-squared:  0.9982 
## F-statistic: 7.282e+04 on 47 and 6277 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This allows us to get a separate constant term and estimate of the impact of IMD on the price of a house <em>for every postcode</em><a href="#fn34" class="footnoteRef" id="fnref34"><sup>34</sup></a>.</p>
</div>
<div id="spatial-dependence" class="section level2">
<h2><span class="header-section-number">5.6</span> Spatial dependence</h2>
<p>As we have just discussed, SH is about effects of phenomena that are <em>explicitly linked</em> to geography and that hence cause spatial variation and clustering of values. This encompasses many of the kinds of spatial effects we may be interested in when we fit linear regressions. However, in other cases, our interest is on the effect of the <em>spatial configuration</em> of the observations, and the extent to which that has an effect on the outcome we are considering. For example, we might think that the price of a house not only depends on the level of deprivation where the house is located, but also whether is close to other highly deprived areas. This kind of spatial effect is fundamentally different from SH in that is it not related to inherent characteristics of the geography but relates to the characteristics of the observations in our dataset and, specially, to their spatial arrangement. We call this phenomenon by which the values of observations are related to each other through distance <em>spatial dependence</em> <span class="citation">(Anselin <a href="#ref-anselin1988spatial">1988</a>)</span>.</p>
<p><strong>Spatial Weights</strong></p>
<p>There are several ways to introduce spatial dependence in an econometric framework, with varying degrees of econometric sophistication <span class="citation">(see Anselin <a href="#ref-anselin2003spatial">2003</a> for a good overview)</span>. Common to all of them however is the way space is formally encapsulated: through <em>spatial weights matrices (<span class="math inline">\(W\)</span>)</em><a href="#fn35" class="footnoteRef" id="fnref35"><sup>35</sup></a>. These are <span class="math inline">\(NxN\)</span> matrices with zero diagonals and every <span class="math inline">\(w_{ij}\)</span> cell with a value that represents the degree of spatial connectivity/interaction between observations <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. If they are not connected at all, <span class="math inline">\(w_{ij}=0\)</span>, otherwise <span class="math inline">\(w_{ij}&gt;0\)</span> and we call <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> neighbors. The exact value in the latter case depends on the criterium we use to define neighborhood relations. These matrices also tend to be row-standardized so the sum of each row equals to one.</p>
<p>A related concept to spatial weight matrices is that of <em>spatial lag</em>. This is an operator that multiplies a given variable <span class="math inline">\(y\)</span> by a spatial weight matrix:</p>
<p><span class="math display">\[
y_{lag} = W y
\]</span></p>
<p>If <span class="math inline">\(W\)</span> is row-standardized, <span class="math inline">\(y_{lag}\)</span> is effectively the average value of <span class="math inline">\(y\)</span> in the neighborhood of each observation. The individual notation may help clarify this:</p>
<p><span class="math display">\[
y_{lag-i} = \displaystyle \sum_j w_{ij} y_j
\]</span></p>
<p>where <span class="math inline">\(y_{lag-i}\)</span> is the spatial lag of variable <span class="math inline">\(y\)</span> at location <span class="math inline">\(i\)</span>, and <span class="math inline">\(j\)</span> sums over the entire dataset. If <span class="math inline">\(W\)</span> is row-standardized, <span class="math inline">\(y_{lag-i}\)</span> becomes an average of <span class="math inline">\(y\)</span> weighted by the spatial criterium defined in <span class="math inline">\(W\)</span>.</p>
<p>Given that spatial weights matrices are not the focus of this tutorial, we will stick to a very simple case. Since we are dealing with points, we will use <span class="math inline">\(K\)</span>-nn weights, which take the <span class="math inline">\(k\)</span> nearest neighbors of each observation as neighbors and assign a value of one, assigning everyone else a zero. We will use <span class="math inline">\(k=150\)</span> to get a good degree of variation and sensible results. If your computer is struggles to compute the following lines of code, you can replace 50 by a lowed number. Technically speaking is the same thing, but the probability that you will pick up only houses in the same LSOA (and hence with exactly the same IMD score) will be higher.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Because some rows are different units on the same house, slightly</span>
<span class="co"># jitter the locations to break ties</span>
xy.jit &lt;-<span class="st"> </span><span class="kw">jitter</span>(db<span class="op">@</span>coords)
<span class="co"># Create knn list of each house</span>
hnn &lt;-<span class="st"> </span><span class="kw">knearneigh</span>(xy.jit, <span class="dt">k=</span><span class="dv">50</span>)
<span class="co"># Create nb object</span>
hnb &lt;-<span class="st"> </span><span class="kw">knn2nb</span>(hnn)
<span class="co"># Create spatial weights matrix (note it row-standardizes by default)</span>
hknn &lt;-<span class="st"> </span><span class="kw">nb2listw</span>(hnb)</code></pre></div>
<p>We can inspect the weights created by simply typing the name of the object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hknn</code></pre></div>
<pre><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 6324 
## Number of nonzero links: 316200 
## Percentage nonzero weights: 0.7906388 
## Average number of links: 50 
## Non-symmetric neighbours list
## 
## Weights style: W 
## Weights constants summary:
##      n       nn   S0      S1       S2
## W 6324 39992976 6324 230.428 25816.55</code></pre>
<p><strong>Exogenous spatial effects</strong></p>
<p>Let us come back to the house price example we have been working with. So far, we have hypothesized that the price of a house sold in Liverpool can be explained using information about whether it is newly built, the level of deprivation of the area where it is located, and its postcode. However, it is also reasonable to think that prospective house owners care about the larger area around a house, not only about its immediate surroundings, and would be willing to pay more for a house that was close to nicer areas, everything else being equal. How could we test this idea?</p>
<p>The most straightforward way to introduce spatial dependence in a regression is by considering not only a given explanatory variable, but also its spatial lag. In our example case, in addition to including the level of deprivation in the area of the house, we will include its spatial lag. In other words, we will be saying that it is not only the level of deprivation of the area where a house is located but also that of the surrounding locations that helps explain the final price at which a house is sold. Mathematically, this implies estimating the following model:</p>
<p><span class="math display">\[
\log{P_i} = \alpha + \beta_{1} NEW_i + \beta_{2} IMD_i + \beta_{3} IMD_{lag-i} + \epsilon_i
\]</span></p>
<p>Let us first compute the spatial lag of imd_score:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">db<span class="op">@</span>data<span class="op">$</span>w_imd_score &lt;-<span class="st"> </span><span class="kw">lag.listw</span>(hknn, db<span class="op">@</span>data<span class="op">$</span>imd_score)</code></pre></div>
<p>And then we can include it in our previous specification. Note that we apply the log to the lag, not the reverse:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># `:` notation implies interaction variables</span>
m6 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">&#39;log(price) ~ new + imd_score + w_imd_score&#39;</span>, db)
<span class="kw">summary</span>(m6)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = &quot;log(price) ~ new + imd_score + w_imd_score&quot;, data = db)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2906 -0.3014 -0.0150  0.2828  5.2631 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 12.2813060  0.0145289 845.302  &lt; 2e-16 ***
## newY         0.2474953  0.0195184  12.680  &lt; 2e-16 ***
## imd_score   -0.0042156  0.0008917  -4.728 2.32e-06 ***
## w_imd_score -0.0148077  0.0009686 -15.288  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5201 on 6320 degrees of freedom
## Multiple R-squared:  0.3347, Adjusted R-squared:  0.3344 
## F-statistic:  1060 on 3 and 6320 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>As we can see, the lag is not only significative and negative (as expected), but its effect seems to be even larger that that of the house itself. Taken literally, this would imply that prospective owners value more the area of the surrounding houses than that of the actual house they buy. However, it is important to remember how these variables have been constructed and what they really represent. Because the IMD score is not exactly calculated at the house level, but at the area level, many of the surrounding houses will share that so, to some extent, the IMD of neighboring houses is that of the house itself<a href="#fn36" class="footnoteRef" id="fnref36"><sup>36</sup></a>. This is likely to be affecting the final parameter, and it is a reminder and an illustration that we cannot take model results as universal truth but we need to use them as tools to inform analysis, couple with theory and what we know about the particular question of analysis. Nevertheless, the example does illustrate how to introduce spatial dependence in a regression framework in a fairly straight forward way.</p>
<p><strong>A note on more advanced spatial regression</strong></p>
<p>Introducing a spatial lag of an explanatory variable, as we have just seen, is the most straightforward way of incorporating the notion of spatial dependence in a linear regression framework. It does not require additional changes, it can be estimated with OLS, and the interpretation is rather similar to interpreting non-spatial variables. The field of spatial econometrics however is a much broader one and has produced over the last decades many techniques to deal with spatial effects and spatial dependence in different ways. Although this might be an over simplification, one can say that most of such efforts for the case of a single cross-section are focused on two main variations: the spatial lag and the spatial error model. Both are similar to the case we have seen in that they are based on the introduction of a spatial lag, but they differ in the component of the model they modify and affect.</p>
<p>The spatial lag model introduces a spatial lag of the <em>dependent</em> variable. In the example we have covered, this would translate into:</p>
<p><span class="math display">\[
\log{P_i} = \alpha + \rho \log{P_{lag-i}} + \beta_{1} NEW_i + \beta_{2} IMD_i + \epsilon_i
\]</span></p>
<p>Although it might not seem very different from the previous equation, this model violates the exogeneity assumption, crucial for OLS to work.</p>
<p>Equally, the spatial error model includes a spatial lag in the <em>error</em> term of the equation:</p>
<p><span class="math display">\[
\log{P_i} = \alpha + \beta_{1r} NEW_i + \beta_{2r} IMD_i + u_i
\]</span></p>
<p><span class="math display">\[
u_i = u_{lag-i} + \epsilon_i
\]</span></p>
<p>Again, although similar, one can show this specification violates the assumptions about the error term in a classical OLS model.</p>
<p>Both the spatial lag and error model violate some of the assumptions on which OLS relies and thus render the technique unusable. Much of the efforts have thus focused on coming up with alternative methodologies that allow unbiased, robust, and efficient estimation of such models. A survey of those is beyond the scope of this note, but the interested reader is referred to <span class="citation">Anselin (<a href="#ref-anselin1988spatial">1988</a>)</span>, <span class="citation">Anselin (<a href="#ref-anselin2003spatial">2003</a>)</span>, and <span class="citation">Anselin and Rey (<a href="#ref-anselin2014modern">2014</a>)</span> for further reference.</p>
</div>
<div id="predicting-house-prices" class="section level2">
<h2><span class="header-section-number">5.7</span> Predicting house prices</h2>
<p>So far, we have seen how exploit the output of a regression model to evaluate the role different variables play in explaining another one of interest. However, once fit, a model can also be used to obtain predictions of the dependent variable given a new set of values for the explanatory variables. We will finish this session by dipping our toes in predicting with linear models.</p>
<p>The core idea is that once you have estimates for the way in which the explanatory variables can be combined to explain the dependent one, you can plug new values on the explanatory side of the model and combine them following the model estimates to obtain predictions. In the example we have worked with, you can imagine this application would be useful to obtain valuations of a house, given we know the IMD of the area where the house is located and whether it is a newly built house or not.</p>
<p>Conceptually, predicting in linear regression models involves using the estimates of the parameters to obtain a value for the dependent variable:</p>
<p><span class="math display">\[
\bar{\log{P_i}} = \bar{\alpha} + \bar{\beta_{1r}} NEW_i^* + \bar{\beta_{2r}} IMD_i^*
\]</span></p>
<p>where <span class="math inline">\(\bar{\log{P_i}}\)</span> is our predicted value, and we include the <span class="math inline">\(\bar{}\)</span> sign to note that it is our estimate obtained from fitting the model. We use the <span class="math inline">\(^*\)</span> sign to note that those can be new values for the explanatory variables, not necessarily those used to fit the model.</p>
<p>Technically speaking, prediction in linear models is fairly streamlined in R. Suppose we are given data for a new house which is to be put in the market. We know it is been newly built on an area with an IMD score of 75, but surrounded by areas that, on average, have a score of 50. Let us record the data first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.house &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">new=</span><span class="st">&#39;Y&#39;</span>, <span class="dt">imd_score=</span><span class="dv">75</span>, <span class="dt">w_imd_score=</span><span class="dv">50</span>)</code></pre></div>
<p>To obtain the prediction for its price, we can use the <code>predict</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.price &lt;-<span class="st"> </span><span class="kw">predict</span>(m6, new.house)
new.price</code></pre></div>
<pre><code>##        1 
## 11.47225</code></pre>
<p>Now remember we were using the log of the price as dependent variable. If we want to recover the actual price of the house, we need to take its exponent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(new.price)</code></pre></div>
<pre><code>##        1 
## 96013.63</code></pre>
<p>According to our model, the house would be worth GBP96,060.29<a href="#fn37" class="footnoteRef" id="fnref37"><sup>37</sup></a>.</p>
</div>
<div id="references-1" class="section level2">
<h2><span class="header-section-number">5.8</span> References</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-anselin1988spatial">
<p>Anselin, Luc. 1988. <em>Spatial Econometrics: Methods and Models</em>. Vol. 4. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-anselin2003spatial">
<p>Anselin, Luc. 2003. “Spatial Externalities, Spatial Multipliers, and Spatial Econometrics.” <em>International Regional Science Review</em> 26 (2). Sage Publications: 153–66.</p>
</div>
<div id="ref-anselin2005spatial">
<p>Anselin, Luc. 2007. “Spatial Regression Analysis in R–A Workbook.” Center for Spatially Integrated Social Science. <a href="http://csiss.org/GISPopSci/workshops/2011/PSU/readings/W15_Anselin2007.pdf" class="uri">http://csiss.org/GISPopSci/workshops/2011/PSU/readings/W15_Anselin2007.pdf</a>.</p>
</div>
<div id="ref-anselin2014modern">
<p>Anselin, Luc, and Sergio J. Rey. 2014. <em>Modern Spatial Econometrics in Practice: A Guide to Geoda, Geodaspace and Pysal</em>. GeoDa Press LLC.</p>
</div>
<div id="ref-arribas2014spatial">
<p>Arribas-Bel, Dani. 2014. “Spatial Data, Analysis, and Regression-a Mini Course.” <em>REGION</em> 1 (1). European Regional Science Association: R1. <a href="http://darribas.org/sdar_mini" class="uri">http://darribas.org/sdar_mini</a>.</p>
</div>
<div id="ref-darribas_gds19">
<p>Arribas-Bel, Dani. 2019. “Geographic Data Science’19.” <a href="http://darribas.org/gds19" class="uri">http://darribas.org/gds19</a>.</p>
</div>
<div id="ref-gelman2006data">
<p>Gelman, Andrew, and Jennifer Hill. 2006a. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Cambridge University Press.</p>
</div>
<div id="ref-gibbons2014spatial">
<p>Gibbons, Stephen, Henry G Overman, and Eleonora Patacchini. 2014. “Spatial Methods.” CEPR Discussion Paper No. DP10135.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Spatial Econometrics</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://darribas.org" property="cc:attributionName" rel="cc:attributionURL">Dani Arribas-Bel</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.<a href="spatial-econometrics.html#fnref25">↩</a></p></li>
<li id="fn26"><p>You can install package <code>mypackage</code> by running the command <code>install.packages(&quot;mypackage&quot;)</code> on the R prompt or through the <code>Tools --&gt; Install Packages...</code> menu in RStudio.<a href="spatial-econometrics.html#fnref26">↩</a></p></li>
<li id="fn27"><p>In this case, the equation would look like <span class="math display">\[P = \alpha + \beta_1 NEW + \beta_2 IMD + \epsilon\]</span> and would be interpreted in terms of vectors and matrices instead of scalar values.<a href="spatial-econometrics.html#fnref27">↩</a></p></li>
<li id="fn28"><p><strong>EXAMPLE</strong> Assume that new houses tend to be built more often in areas with low deprivation. If that is the case, then <span class="math inline">\(NEW\)</span> and <span class="math inline">\(IMD\)</span> will be correlated with each other (as well as with the price of a house, as we are hypothesizing in this case). If we calculate a simple correlation between <span class="math inline">\(P\)</span> and <span class="math inline">\(IMD\)</span>, the coefficient will represent the degree of association between both variables, but it will also include some of the association between <span class="math inline">\(IMD\)</span> and <span class="math inline">\(NEW\)</span>. That is, part of the obtained correlation coefficient will be due not to the fact that higher prices tend to be found in areas with low IMD, but to the fact that new houses tend to be more expensive. This is because (in this example) new houses tend to be built in areas with low deprivation and simple bivariate correlation cannot account for that.<a href="spatial-econometrics.html#fnref28">↩</a></p></li>
<li id="fn29"><p>Keep in mind that regression is no magic. We are only discounting the effect of other confounding factors that we include in the model, not of <em>all</em> potentially confounding factors.<a href="spatial-econometrics.html#fnref29">↩</a></p></li>
<li id="fn30"><p><strong>EXERCISE</strong> <em>How does the type of a house affect the price at which it is sold, given whether it is new and the level of deprivation of the area where it is located?</em> To answer this, fit a model as we have done but including additionally the variable <code>type</code>. In order to interpret the codes, check the reference at the <a href="https://www.gov.uk/guidance/about-the-price-paid-data#explanations-of-column-headers-in-the-ppd">Land Registry documentation</a>.<a href="spatial-econometrics.html#fnref30">↩</a></p></li>
<li id="fn31"><p><strong>QUESTION</strong> How would you incorporate this into a regression model that extends the log-log equation of the previous section?<a href="spatial-econometrics.html#fnref31">↩</a></p></li>
<li id="fn32"><p>Additionally, estimating spatial FE in our particular example also gives you an indirect measure of area <em>desirability</em>: since they are simple dummies in a regression explaining the price of a house, their estimate tells us about how much people are willing to pay to live in a given area. However, this interpretation does not necessarily apply in other contexts where introducing spatial FEs does make sense. <strong>EXERCISE</strong> <em>What is the most desired area to live in Liverpool?</em><a href="spatial-econometrics.html#fnref32">↩</a></p></li>
<li id="fn33"><p>Note this still returns a <code>NA</code> for the IMD estimate in <code>L20</code>. This is most likely due to the little amount of houses (five) sold in that area. The regression nevertheless serves the illustration<a href="spatial-econometrics.html#fnref33">↩</a></p></li>
<li id="fn34"><p><strong>PRO EXERCISE</strong> <em>How does the effect of IMD vary over space?</em> You can answer this by looking at the coefficients of <code>imd_score</code> over postcodes, but it would be much clearer if you could create a choropleth of the house locations where each dot is colored based on the value of the <code>imd_score</code> estimated for that postcode.<a href="spatial-econometrics.html#fnref34">↩</a></p></li>
<li id="fn35"><p>If you need to refresh your knowledge on spatial weight matrices, check <a href="http://darribas.org/gds15/notes/Class_05.html">Lecture 5</a> of <span class="citation">(<span class="citeproc-not-found" data-reference-id="darribas_gds15"><strong>???</strong></span>)</span><a href="spatial-econometrics.html#fnref35">↩</a></p></li>
<li id="fn36"><p><strong>EXERCISE</strong> <em>How do results change if you modify the number of neighbors included to compute the <span class="math inline">\(K\)</span>-nn spatial weight matrix?</em> Replace the originak <span class="math inline">\(k\)</span> used and re-run the regressions. Try to interpret the results and the (potential) differences with the original ones.<a href="spatial-econometrics.html#fnref36">↩</a></p></li>
<li id="fn37"><p><strong>EXERCISE</strong> <em>How would the price change if the surrounding houses did not have an average of 50 but of 80?</em> Obtain a new prediction and compare it with the original one.<a href="spatial-econometrics.html#fnref37">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="flows.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevel-modelling-part-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-spatial_econometrics.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["spatial_analysis_notes.pdf", "spatial_analysis_notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
